# General rules for using BoXFP

BoXFP utilises dye size sets (DSSs) included in the capillary electrophoresis (CE) data to determine nucleotide (nt) position and spacing within the CE traces.
There are 3 different modes for DSS use in the BoXFP package. 

1. The entire DSS is used
2. Part of the DSS is used
3. Extrapolation is used to calculate the reactivity profile beyond the DSS


## Using the entire DSS
The default setting for the BoXFP functions has the full DSS used. For instance, the DSS ROX-400HD contains 21 different DNA fragments ranging in size from 50 to 400 nts.
By default, BoXFP functions will utilise all the 21 peaks generated by the DNA fragments, resulting in a profile of 350 nts generated.

## Using a subset of the DSS
However, the entire DSS cannot and should not be used in all cases, particularly if an exit peak is located within the DSS peaks. This occurs if the start position of the primer used
less than the size of the largest DNA fragment in the DSS (in the case of ROX-400HD this would mean a primer start position <400 nts into the sequence under investigation).
Furthermore, due to the size of the exit peak, it is advised that the DSS peak set is not used unless the primer start position is at least 10 nts greater than the size of the largest DNA
fragment in the DSS (for ROX-400HD this would be a primer start position >410 nts). 

Because that the intense exit peak has on preprocessing (see [preprocessing tutorial](Tutorial/Data_preprocessing.md)), using the reduced DDS peak set should be considered during 
Pre-processing and reactivity calculations. In the wrapper function `RX_preprocess`, a subset of the DSS peak set can be specified using the `Top` argument (if you only want to use the first 
4 peaks in the peak set `Top` should be set to 4). The `end` should also be set to a value below the location of the exit peak to better facilitate DSS peak location. 

During the position determination and reactivity calculation steps the reduced subset of DSS peaks must also be specified. in the reactivity calculation wrapper function `RX_analyse`
the `sm_cutoff` argument when assigned a negative value indicates that a smaller subset is required (setting `sm_cutoff` to -4 indicates that the first 4 DSS peaks are to be used). 

In the position determination wrapper algorithm `RX_position` the reduced subset does not necessarily need to be calculated however the `clip` argument should be set to the number of nucleotides
in the reduced size marker set (the first 4 DSS peaks cover 50 nts, therefore the `clip` argument should ideally be set to 50)


## Using an extended version of the DSS

In most cases the chromatographs do not contain exit peaks. If this is the case then, and there are no anomalous peaks in the chromatograph, then most of the chromatograph above the entry peak can be analysed. For the windowing process in the cases mentioned above we have used size marker peaks as a point of reference for the upper limit of the windows, in the case where no exit peak exists, we can use the end of the chromatographs as the point of reference for the upper limits of the windows. To do so we need to set we do not need to specify the end argument, but we do need to set the `Top` argument of `RX_preprocess` to `None`, indicating we are not using the DSS peak set as a reference point. 

Although the positions of the DSS peaks will shift between different chromatographs, the distances between peaks exhibits minimal variation (variation are usually <2 elution points). Because of this we can use the DSS peaks in the ensemble to extrapolate beyond the original DSS peak set, generating a 'pseudo-set' of additional DSS peaks. In BoXFP, this extension is performed in sets of 10 nts and is performed in the reactivity calculation step. In the wrapper function `RX_analyse` the number of pseudo-peaks can be specified by setting the `sm_cutoff` argument to >0. Note that it is not advised to set `sm_cutoff` to a value greater than 15 (which results in an extra 150 nts in the reactivity profile).  

Note that there is currently no option to extend the DSS peaks in the position determination step. To get the position for an extended reactivity profile, we must determine the position using the full set of DSS peaks and then calculate back to determine the start with the extension (for a 150 nt extension this would mean taking the value calculated using the position determination step and then subtracting 150 from this value).



